# 简介

书柜项目

## 技术栈

- SqlLite
- Prisma2
- typescript
- Koa
- Redis

## 思路

- 用户身份认证
- 用户管理自己的书柜

- 管理员身份认证
- 用户管理
- 角色管理
- 权限管理（菜单，数据颗粒，数据操作）
- 书柜管理

### 认证

#### 注册

1. 校验信息(用户名，密码, 邮箱)
2. 创建用户(..., 状态)
3. 成功注册

#### 忘记密码

阶段 = A

1. 校验信息(邮箱)
2. 检查信息有效性
3. 生成校验码
4. 生成邮件代码
5. 发送邮件
6. 发送成功

阶段 = B

1. 校验信息(邮箱，用户名，校验码，新密码)
2. 检查信息有效性
3. 设置成功

#### 登录

1. 校验信息(用户名，密码)
2. 检查信息有效性
3. 生成 token
4. 登录成功

#### 身份校验

1. 检验信息(token)
2. 检查信息有效性
3. 检查用户有效性
4. 校验成功(通过/未通过)

### 错误拦截器

1. 数据库错误
2. 服务层错误
3. 校验层错误
4. 应用层错误

### 角色

设置用户角色

- 用户：user
- 管理员：admin

系统使用的是前后端分离的方式，这里传统的 rbac 里的资源（resource）和行为（action）在这里可使用接口的方式处理

```txt
req -> role -> role:resource:action
req -> role -> role:method:path
```

因为 resource:action 可以确定角色的唯一权限，对于接口来时 method:path 也是唯一的。使用接口的权限方式适用于权限系统扁平的项目，且接口的权限继承，动态路径的变量判断也需要自己编写，这里推荐适用 [Casbin](https://casbin.org/docs/zh-CN/function)，当前项目使用 resource:action 的权限管理方式

- 角色无法继承
- 一个账号仅可有一个角色
- 一个角色有多个资源权限（实际就是接口）
- 一个角色有多个菜单权限（页面，按钮）

### 权限

权限关联资源，行为。且权限有组进行分离

- 权限无辐射范围
- 权限无继承

### 菜单

菜单有页面层级，且菜单有多种分类，页面仅代表读，而写相关的均为按钮

### 权限认证系统关联

用户->权限->菜单->页面，按钮
用户->权限->接口->权限

#### 用户

登录，注册，忘记密码，个人信息，个人信息修改，书柜创建，书柜编辑，书柜删除，书籍创建，书籍编辑，书籍删除，书柜添加书籍，书柜书籍转移，书籍添加标签，创建书籍标签，书籍标签删除，书籍书签编辑，书籍标签编辑

#### 管理员

登录，个人信息，个人信息修改，用户管理，角色管理，权限管理，菜单管理，书柜管理，书籍管理，书籍标签管理，登录记录，接口日志，系统日志，邮件记录
